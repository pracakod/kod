<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Shop Planer</title>
    <style>
        :root {
            --primary: #0050aa;
            --accent: #e3000f;
            --bg: #f4f4f4;
            --surface: #ffffff;
            --text: #333333;
            --border: #dddddd;
            --path: #e0e0e0;
            --success: #28a745;
        }

        [data-theme="dark"] {
            --primary: #4dabf7;
            --accent: #ff6b6b;
            --bg: #121212;
            --surface: #1e1e1e;
            --text: #e0e0e0;
            --border: #333333;
            --path: #2c2c2c;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        html, body {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg); color: var(--text);
            overflow: hidden;
        }

        body { display: flex; flex-direction: column; }

        /* --- HEADER --- */
        header {
            flex: 0 0 60px;
            background: var(--surface); color: var(--text); padding: 0 15px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); z-index: 30;
        }
        h1 { margin: 0; font-size: 18px; font-weight: 800; color: var(--primary); }

        .header-btn {
            background: none; border: 1px solid var(--border); border-radius: 8px;
            padding: 6px 12px; cursor: pointer; display: flex; align-items: center; gap: 6px;
            font-size: 13px; color: var(--text);
        }

        /* --- KONTROLKI (Przyklejone pod headerem) --- */
        #aisle-controls {
            flex: 0 0 auto; /* Nie rozciƒÖga siƒô */
            background: var(--surface); padding: 10px; border-bottom: 1px solid var(--border);
            display: flex; justify-content: center; align-items: center; gap: 20px;
            z-index: 20;
        }
        .len-btn {
            background: var(--bg); border: 1px solid var(--border); border-radius: 20px;
            padding: 8px 25px; font-weight: bold; font-size: 16px; color: var(--text);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .len-btn:active { transform: scale(0.95); background: var(--border); }

        /* --- OBSZAR ROBOCZY --- */
        #main-content {
            flex: 1; /* Zajmuje ca≈ÇƒÖ resztƒô miejsca */
            position: relative;
            overflow: hidden;
        }

        .view-section {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            display: none;
            padding-bottom: 20px;
        }
        .view-section.active-view { display: block; }

        /* --- WIDOK SKLEPU --- */
        #aisle-container {
            padding: 20px 15px 60px 15px;
            display: flex; flex-direction: column; gap: 10px; align-items: center;
        }

        .store-row {
            display: grid; grid-template-columns: 1fr 40px 1fr; /* ≈örodek wƒô≈ºszy, bez ludzika */
            width: 100%; max-width: 500px; height: 80px; align-items: center;
        }

        /* ≈öcie≈ºka (czysta, bez kresek) */
        .path-center {
            height: 100%; background-color: var(--path);
            border-radius: 6px; opacity: 0.5;
        }

        .shelf-slot {
            height: 75px; background: var(--surface); border-radius: 12px; margin: 0 5px;
            border: 2px solid var(--border); display: flex; flex-direction: column;
            justify-content: center; align-items: center; font-size: 11px; color: #999;
            position: relative; overflow: hidden; transition: 0.15s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .shelf-slot:active { transform: scale(0.98); }
        
        .shelf-slot.filled { border: 2px solid var(--primary); color: var(--primary); font-weight: 700; }
        .shelf-slot .s-icon { font-size: 28px; margin-bottom: 2px; }
        
        /* Pasek przytrzymania */
        .hold-bar {
            position: absolute; bottom: 0; left: 0; height: 4px; background: var(--accent);
            width: 0%; transition: width 0.1s linear;
        }

        /* --- CHECKLISTA --- */
        #checklist-container { padding: 15px; padding-bottom: 80px; }
        
        .cl-group { background: var(--surface); border-radius: 12px; padding: 0 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        .cl-title { 
            font-size: 13px; font-weight: 800; color: var(--primary); text-transform: uppercase; 
            padding: 12px 0 8px 0; border-bottom: 1px solid var(--border); 
        }
        
        .cl-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .cl-item:last-child { border-bottom: none; }
        
        .cl-check-box {
            width: 26px; height: 26px; border: 2px solid #ccc; border-radius: 6px; margin-right: 12px;
            display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0;
            font-size: 16px; font-weight: bold; transition: 0.2s;
        }
        .cl-text { flex: 1; font-size: 16px; color: var(--text); transition: 0.2s; }

        .cl-item.is-checked .cl-check-box { background: var(--success); border-color: var(--success); }
        .cl-item.is-checked .cl-text { text-decoration: line-through; color: #aaa; }
        .cl-item.is-checked { opacity: 0.6; }

        /* --- NAV (STICKY BOTTOM) --- */
        nav {
            flex: 0 0 70px;
            background: var(--surface); border-top: 1px solid var(--border);
            display: flex; z-index: 40;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-btn {
            flex: 1; background: none; border: none; display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 5px;
            color: #999; font-size: 11px; font-weight: bold; padding: 5px;
        }
        .nav-btn.active { color: var(--primary); }
        .icon-svg { width: 24px; height: 24px; fill: currentColor; }

        .badge {
            background: var(--accent); color: white; border-radius: 10px; padding: 2px 6px;
            font-size: 10px; position: absolute; margin-left: 20px; margin-top: -10px; display: none;
        }

        /* --- MODALS --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 2000; display: none;
            align-items: flex-end; justify-content: center; backdrop-filter: blur(2px);
        }
        .modal-content {
            background: var(--surface); width: 100%; max-width: 600px; max-height: 85vh;
            border-radius: 24px 24px 0 0; padding: 20px; display: flex; flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        @keyframes slideUp { from { transform:translateY(100%); } to { transform:translateY(0); } }

        .prod-list { flex: 1; overflow-y: auto; margin-top: 15px; }
        .prod-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px; border-bottom: 1px solid var(--border);
        }
        .add-btn {
            width: 36px; height: 36px; border-radius: 50%; border: none; background: var(--bg);
            font-size: 20px; display: flex; align-items: center; justify-content: center; color: var(--text);
        }
        .add-btn.added { background: var(--success); color: white; }

        .shelf-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding-bottom: 20px;}
        .shelf-btn {
            display: flex; flex-direction: column; align-items: center; padding: 15px;
            border: 1px solid var(--border); border-radius: 12px; background: var(--bg); color: var(--text); font-size: 11px;
        }
        
        #new-cat-form { background: var(--bg); padding: 15px; border-radius: 12px; margin-bottom: 15px; display: none; border: 1px solid var(--border); }

    </style>
</head>
<body data-theme="light">

    <header>
        <h1>Smart Planer</h1>
        <div style="display:flex; gap:10px;">
            <button class="header-btn" onclick="toggleTheme()">
                <svg class="icon-svg" viewBox="0 0 24 24" style="width:16px; height:16px;"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
                Motyw
            </button>
            <button class="header-btn" onclick="openTemplateModal()">
                <svg class="icon-svg" viewBox="0 0 24 24" style="width:16px; height:16px;"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                Zapisz
            </button>
        </div>
    </header>

    <!-- PANEL KONTROLNY (NIERUCHOMY) -->
    <div id="aisle-controls">
        <button class="len-btn" onclick="changeLength(-1)">‚ûñ Mniej</button>
        <button class="len-btn" onclick="changeLength(1)">‚ûï Wiƒôcej</button>
    </div>

    <!-- G≈Å√ìWNY KONTENER (SCROLLOWANY WEWNƒÑTRZ) -->
    <div id="main-content">
        
        <!-- WIDOK SKLEPU -->
        <div id="aisle-view" class="view-section active-view">
            <div id="aisle-container"></div>
        </div>

        <!-- WIDOK LISTY -->
        <div id="checklist-view" class="view-section">
            <div id="checklist-container"></div>
        </div>

    </div>

    <nav>
        <button class="nav-btn active" onclick="switchMode('plan')" id="nav-plan">
            <svg class="icon-svg" viewBox="0 0 24 24"><path d="M20 4H4v2h16V4zm1 10v-2l-1-5H4l-1 5v2h1v6h10v-6h4v6h2v-6h1zm-9 4H6v-4h6v4z"/></svg>
            <span>Sklep</span>
            <span id="badge-plan" class="badge">0</span>
        </button>
        <button class="nav-btn" onclick="switchMode('list')" id="nav-list">
            <svg class="icon-svg" viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
            <span>Lista</span>
            <span id="badge-list" class="badge">0</span>
        </button>
    </nav>

    <!-- MODAL PRODUKT√ìW -->
    <div id="prod-modal" class="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 id="pm-title" style="margin:0; color:var(--primary);">Kategoria</h3>
                <button onclick="closeModal()" style="border:none; background:none; font-size:28px; color:var(--text)">&times;</button>
            </div>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <input type="text" id="custom-input" placeholder="Wpisz nazwƒô..." style="flex:1; padding:12px; border:1px solid var(--border); border-radius:8px; background:var(--bg); color:var(--text);">
                <button onclick="addCustomProduct()" style="background:var(--primary); color:white; border:none; border-radius:8px; width:50px; font-size:24px;">+</button>
            </div>
            <div id="pm-list" class="prod-list"></div>
        </div>
    </div>

    <!-- MODAL EDYCJI -->
    <div id="edit-modal" class="modal">
        <div class="modal-content" style="height:90vh;">
            <h3 style="margin-top:0;">Edytuj Rega≈Ç</h3>
            <button onclick="toggleNewCatForm()" style="width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:8px; margin-bottom:10px; font-weight:bold;">‚ûï Nowa Kategoria</button>
            
            <div id="new-cat-form">
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <input type="text" id="new-cat-icon" placeholder="Iko" style="width:60px; text-align:center; padding:10px; border:1px solid var(--border); border-radius:8px; background:var(--surface); color:var(--text);">
                    <input type="text" id="new-cat-name" placeholder="Nazwa" style="flex:1; padding:10px; border:1px solid var(--border); border-radius:8px; background:var(--surface); color:var(--text);">
                </div>
                <button onclick="saveNewCategory()" style="width:100%; background:var(--accent); color:white; border:none; padding:10px; border-radius:8px; font-weight:bold;">Zapisz</button>
            </div>

            <div style="overflow-y:auto; flex:1;">
                <div class="shelf-grid" id="shelf-grid"></div>
            </div>
            <button onclick="setShelf(null)" style="margin-top:15px; padding:15px; background:#ff6b6b; color:white; border:none; border-radius:12px; font-weight:bold;">üóë Usu≈Ñ Rega≈Ç</button>
        </div>
    </div>

    <!-- MODAL SZABLON√ìW -->
    <div id="tpl-modal" class="modal">
        <div class="modal-content" style="height:auto;">
            <h3>Zapisz Sklep</h3>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <input type="text" id="tpl-name" placeholder="Nazwa..." style="flex:1; padding:12px; border:1px solid var(--border); border-radius:8px; background:var(--bg); color:var(--text);">
                <button onclick="saveTemplate()" style="background:var(--primary); color:white; border:none; padding:0 20px; border-radius:8px; font-weight:bold;">Zapisz</button>
            </div>
            <div style="max-height:200px; overflow-y:auto; margin-bottom:10px;">
                <div id="tpl-list"></div>
            </div>
            <button onclick="closeModal()" style="width:100%; padding:12px; background:var(--bg); border:none; border-radius:8px; color:var(--text); font-weight:bold;">Zamknij</button>
        </div>
    </div>

    <script>
        const DEFAULT_CATS = {
            "Pieczywo": {icon:"üçû", items:["Chleb", "Bu≈Çki", "Bagietka", "PƒÖczek"]},
            "Warzywa": {icon:"ü•¶", items:["Ziemniaki", "Pomidory", "Og√≥rki", "Cebula", "Sa≈Çata"]},
            "Owoce": {icon:"üçé", items:["Banany", "Jab≈Çka", "Cytryny", "Winogrona", "Mandarynki"]},
            "Nabia≈Ç": {icon:"ü•õ", items:["Mleko", "Mas≈Ço", "Ser ≈ª√≥≈Çty", "Jogurt", "Jajka"]},
            "Miƒôso": {icon:"ü•©", items:["Kurczak", "Szynka", "Kie≈Çbasa", "Boczek"]},
            "Napoje": {icon:"ü•§", items:["Woda", "Sok", "Cola", "Kawa", "Piwo"]},
            "S≈Çodycze": {icon:"üç´", items:["Czekolada", "Baton", "Ciastka", "Chipsy"]},
            "Chemia": {icon:"üßº", items:["Papier Toaletowy", "P≈Çyn do naczy≈Ñ", "Proszek"]},
            "Mro≈ºonki": {icon:"üßä", items:["Frytki", "Pizza", "Lody"]},
            "≈öwiƒôta": {icon:"üéÖ", items:["Karp", "Op≈Çatek", "Barszcz", "Pierogi"]},
            "Sylwester": {icon:"üéÜ", items:["Szampan", "Chipsy", "PrzekƒÖski", "Zimne ognie"]}
        };

        let storeLayout = [];
        let shoppingList = [];
        let categories = {};
        let editTarget = {row:0, side:'left'};
        let holdTimer = null;

        function init() {
            const savedCats = localStorage.getItem('shop_cats_v2');
            categories = savedCats ? JSON.parse(savedCats) : JSON.parse(JSON.stringify(DEFAULT_CATS));

            for(let i=0; i<15; i++) storeLayout.push({left:null, right:null});
            storeLayout[0].left = {cat:"WEJ≈öCIE", icon:"üö™", type:"entrance"};
            storeLayout[1].left = {cat:"Pieczywo", icon:"üçû"};
            storeLayout[1].right = {cat:"Nabia≈Ç", icon:"ü•õ"};
            storeLayout[14].right = {cat:"KASA", icon:"üí≥", type:"checkout"};

            renderStore();
            renderShelfGrid();
        }

        function renderStore() {
            const container = document.getElementById('aisle-container');
            container.innerHTML = '';

            storeLayout.forEach((row, idx) => {
                const div = document.createElement('div');
                div.className = 'store-row';
                
                div.appendChild(createSlot(row.left, idx, 'left'));
                div.appendChild(document.createElement('div')); // Pusty ≈õrodek zamiast path-center
                div.appendChild(createSlot(row.right, idx, 'right'));
                container.appendChild(div);
            });
        }

        function createSlot(data, r, side) {
            const el = document.createElement('div');
            el.className = 'shelf-slot';
            if(data) {
                el.classList.add('filled');
                if(data.type) el.style.borderColor = data.type === 'entrance' ? '#28a745' : '#ffc107';
                el.innerHTML = `<span class="s-icon">${data.icon}</span><span>${data.cat}</span><div class="hold-bar"></div>`;
            } else {
                el.innerHTML = `<span style="font-size:24px; opacity:0.2;">+</span>`;
            }

            const startHold = () => {
                const bar = el.querySelector('.hold-bar');
                if(bar) bar.style.width = '100%';
                holdTimer = setTimeout(() => {
                    if(bar) bar.style.width = '0%';
                    editTarget = {row:r, side:side};
                    document.getElementById('new-cat-form').style.display = 'none';
                    document.getElementById('edit-modal').style.display = 'flex';
                }, 600);
            };

            const endHold = () => {
                clearTimeout(holdTimer);
                const bar = el.querySelector('.hold-bar');
                if(bar) bar.style.width = '0%';
            };

            el.addEventListener('touchstart', startHold);
            el.addEventListener('touchend', endHold);
            el.addEventListener('mousedown', startHold);
            el.addEventListener('mouseup', endHold);

            el.onclick = () => {
                clearTimeout(holdTimer);
                if(!data) {
                    editTarget = {row:r, side:side};
                    document.getElementById('edit-modal').style.display = 'flex';
                } else if(!data.type) {
                    el.scrollIntoView({behavior:'smooth', block:'center'});
                    setTimeout(() => openProducts(data.cat), 250);
                }
            };
            return el;
        }

        function openProducts(catName) {
            document.getElementById('pm-title').innerText = catName;
            const list = document.getElementById('pm-list');
            list.innerHTML = '';
            
            const items = categories[catName]?.items || [];
            items.forEach(item => {
                const row = document.createElement('div');
                row.className = 'prod-row';
                row.innerHTML = `<span>${item}</span>`;
                const btn = document.createElement('button');
                btn.className = 'add-btn';
                if(shoppingList.some(i => i.name === item)) {
                    btn.classList.add('added'); btn.innerText = '‚úî';
                } else {
                    btn.innerText = '+';
                }
                btn.onclick = () => toggleProduct(item, catName, btn);
                row.appendChild(btn);
                list.appendChild(row);
            });
            document.getElementById('prod-modal').style.display = 'flex';
        }

        function toggleProduct(name, cat, btn) {
            const idx = shoppingList.findIndex(i => i.name === name);
            if(idx > -1) {
                shoppingList.splice(idx, 1);
                btn.classList.remove('added'); btn.innerText = '+';
            } else {
                shoppingList.push({name, cat, checked:false});
                btn.classList.add('added'); btn.innerText = '‚úî';
            }
            updateBadge();
        }

        function addCustomProduct() {
            const val = document.getElementById('custom-input').value.trim();
            const cat = document.getElementById('pm-title').innerText;
            if(val && categories[cat]) {
                shoppingList.push({name: val, cat, checked: false});
                if(!categories[cat].items.includes(val)) {
                    categories[cat].items.push(val);
                    localStorage.setItem('shop_cats_v2', JSON.stringify(categories));
                }
                document.getElementById('custom-input').value = '';
                updateBadge();
                openProducts(cat);
            }
        }

        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = '';
            if(shoppingList.length === 0) {
                container.innerHTML = '<div style="text-align:center; margin-top:50px; opacity:0.5;">Koszyk pusty</div>';
                return;
            }
            const grouped = {};
            shoppingList.forEach((item, i) => {
                if(!grouped[item.cat]) grouped[item.cat] = [];
                grouped[item.cat].push({...item, idx: i});
            });
            for(const cat in grouped) {
                const grp = document.createElement('div');
                grp.className = 'cl-group';
                const title = document.createElement('div');
                title.className = 'cl-title'; title.innerText = cat;
                grp.appendChild(title);
                grouped[cat].forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'cl-item' + (item.checked ? ' is-checked' : '');
                    const check = document.createElement('div');
                    check.className = 'cl-check-box';
                    if(item.checked) check.innerText = '‚úî';
                    const text = document.createElement('div');
                    text.className = 'cl-text'; text.innerText = item.name;
                    const delBtn = document.createElement('button');
                    delBtn.innerHTML = '<svg class="icon-svg" viewBox="0 0 24 24" style="opacity:0.5"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>';
                    delBtn.style.border='none'; delBtn.style.background='none'; delBtn.style.marginLeft='10px';
                    delBtn.onclick = (e) => {
                        e.stopPropagation(); shoppingList.splice(item.idx, 1);
                        renderChecklist(); updateBadge();
                    };
                    row.appendChild(check); row.appendChild(text); row.appendChild(delBtn);
                    row.onclick = () => {
                        shoppingList[item.idx].checked = !shoppingList[item.idx].checked;
                        renderChecklist(); updateBadge();
                    };
                    grp.appendChild(row);
                });
                container.appendChild(grp);
            }
        }

        function renderShelfGrid() {
            const grid = document.getElementById('shelf-grid');
            grid.innerHTML = '';
            const specials = [{n:"WEJ≈öCIE", i:"üö™", t:"entrance", c:"#28a745"}, {n:"KASA", i:"üí≥", t:"checkout", c:"#ffc107"}];
            specials.forEach(s => {
                const btn = document.createElement('button');
                btn.className = 'shelf-btn'; btn.style.borderColor = s.c;
                btn.innerHTML = `<span style="font-size:20px">${s.i}</span><b>${s.n}</b>`;
                btn.onclick = () => setShelf(s.n, s.i, s.t);
                grid.appendChild(btn);
            });
            Object.keys(categories).forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'shelf-btn';
                btn.innerHTML = `<span style="font-size:20px">${categories[cat].icon}</span><span>${cat}</span>`;
                btn.onclick = () => setShelf(cat, categories[cat].icon);
                grid.appendChild(btn);
            });
        }

        function toggleNewCatForm() {
            const f = document.getElementById('new-cat-form');
            f.style.display = f.style.display === 'block' ? 'none' : 'block';
        }
        function saveNewCategory() {
            const name = document.getElementById('new-cat-name').value.trim();
            const icon = document.getElementById('new-cat-icon').value.trim() || 'üì¶';
            if(name) {
                categories[name] = { icon: icon, items: [] };
                localStorage.setItem('shop_cats_v2', JSON.stringify(categories));
                renderShelfGrid(); setShelf(name, icon);
                document.getElementById('new-cat-name').value = '';
            }
        }
        function setShelf(cat, icon, type=null) {
            const {row, side} = editTarget;
            if(cat === null) storeLayout[row][side] = null;
            else storeLayout[row][side] = {cat, icon, type};
            closeModal(); renderStore();
        }
        function changeLength(d) {
            if(d===1) storeLayout.push({left:null, right:null});
            else if(storeLayout.length > 5) storeLayout.pop();
            renderStore();
        }
        function updateBadge() {
            const n = shoppingList.filter(i => !i.checked).length;
            document.querySelectorAll('.badge').forEach(b => {
                b.innerText = n; b.style.display = n > 0 ? 'inline-block' : 'none';
            });
        }
        function switchMode(m) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active-view'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(m === 'plan') {
                document.getElementById('aisle-view').classList.add('active-view');
                document.getElementById('aisle-controls').style.display = 'flex';
                document.getElementById('nav-plan').classList.add('active');
            } else {
                document.getElementById('checklist-view').classList.add('active-view');
                document.getElementById('aisle-controls').style.display = 'none';
                document.getElementById('nav-list').classList.add('active');
                renderChecklist();
            }
        }
        function toggleTheme() {
            const b = document.body;
            b.setAttribute('data-theme', b.getAttribute('data-theme')==='light'?'dark':'light');
        }
        function openTemplateModal() { document.getElementById('tpl-modal').style.display='flex'; loadTemplates(); }
        function closeModal() { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); }
        function saveTemplate() {
            const name = document.getElementById('tpl-name').value;
            if(name) {
                const db = JSON.parse(localStorage.getItem('layouts_v2') || '{}');
                db[name] = storeLayout;
                localStorage.setItem('layouts_v2', JSON.stringify(db));
                loadTemplates(); document.getElementById('tpl-name').value = '';
            }
        }
        function loadTemplates() {
            const list = document.getElementById('tpl-list');
            list.innerHTML = '';
            const db = JSON.parse(localStorage.getItem('layouts_v2') || '{}');
            Object.keys(db).forEach(k => {
                const d = document.createElement('div');
                d.style.padding='10px'; d.style.borderBottom='1px solid #eee'; d.style.display='flex'; d.style.justifyContent='space-between';
                d.innerHTML = `<span>${k}</span>`;
                const b = document.createElement('button'); b.innerText='Wczytaj';
                b.style.background='var(--primary)'; b.style.color='white'; b.style.border='none'; b.style.padding='5px 10px'; b.style.borderRadius='6px';
                b.onclick = ()=>{ storeLayout=db[k]; renderStore(); closeModal(); };
                d.appendChild(b); list.appendChild(d);
            });
        }

        init();
    </script>
</body>
</html>
